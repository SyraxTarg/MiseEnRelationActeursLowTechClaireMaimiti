CREATE DATABASE lowTech;
\c lowtech;
CREATE TABLE Users(id SERIAL PRIMARY KEY, username VARCHAR(50), password VARCHAR(50), profile_picture VARCHAR(50), email VARCHAR(50));
CREATE TABLE Particuliers(id_user int, activités VARCHAR(50), FOREIGN KEY(id_user) REFERENCES Users(id));
CREATE TABLE Modérateurs(id_user int, activités VARCHAR(50), FOREIGN KEY(id_user) REFERENCES Users(id));
CREATE TABLE Admins(id_user int, FOREIGN KEY(id_user) REFERENCES Users(id));
CREATE TABLE Annonces(id SERIAL PRIMARY KEY, titre VARCHAR(50), description TEXT, id_user int, date date, id_annonce_mère int, image VARCHAR(255), nb_likes int, FOREIGN KEY(id_user) REFERENCES Users(id), FOREIGN KEY(id_annonce_mère) REFERENCES Annonces(id));
ALTER TABLE Users ALTER COLUMN profile_picture TYPE VARCHAR(255);
CREATE TABLE Recherche(id_annonce int, FOREIGN KEY(id_annonce) REFERENCES Annonces(id));
CREATE TABLE Avancées(id_annonce int, FOREIGN KEY(id_annonce) REFERENCES Annonces(id));
CREATE TABLE Dispos(id_annonce int, FOREIGN KEY(id_annonce) REFERENCES Annonces(id));

INSERT INTO Users(username, password, profile_picture, email) VALUES ('John Doe', 'motDePass
e', 'https://www.google.com/url?sa=i&url=https%3A%2F%2Ffr.wikipedia.org%2Fwiki%2FLion&psig=AOvVaw3nNornN2MDSeaq5F62rsVH&ust=1703105590269000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCODoqvCwnIMDFQAAAAAdAAAAABAD', 'john.doe@mail.com');
INSERT INTO Particuliers( SELECT id FROM Users WHERE email = 'john.doe@mail.com');

INSERT INTO Users(username, password, email) VALUES ('Jane Doe', 'motDePasseDeJane', 'jane.doe@mail.com');
INSERT INTO Particuliers( SELECT id FROM Users WHERE email = 'jane.doe@mail.com');

ALTER TABLE Users ALTER COLUMN profile_picture TYPE VARCHAR(500);

INSERT INTO Users(username, password, email) VALUES ('Clark Kent', 'jeSuisSuperman', 'clark.kent@mail.com');
INSERT INTO Modérateurs( SELECT id FROM Users WHERE email = 'clark.kent@mail.com');
INSERT INTO Users(username, password, profile_picture, email) VALUES ('Bruce Wayne', 'jeSuisBatman', 'https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.comicsuniverse.it%2Fil-futuro-di-michael-keaton-come-batman-dopo-the-flash-e-incerto-rimarra-canonico-o-no%2F&psig=AOvVaw0faW7TlQ6P4MArTxTvcJl4&ust=1703105999643000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCOCbubaynIMDFQAAAAAdAAAAABAI', 'bruce.wayne@mail.com');
INSERT INTO Modérateurs( SELECT id FROM Users WHERE email = 'bruce.wayne@mail.com');

ALTER TABLE Users ADD Activités TEXT;


INSERT INTO Annonces(titre, description, id_user, nb_likes) VALUES ('Manque de bois', 'Nous manquons de bois.',  (SELECT Modérateurs.id_user FROM Modérateurs JOIN Users ON Modérateurs.id_user = Users.id WHERE Users.email = 'bruce.wayne@mail.com'), 0);

INSERT INTO Annonces(description, id_user, id_annonce_mère, date, nb_likes) VALUES ('Pas de souci je peux en ramener',  (SELECT Particuliers.id_user FROM Particuliers JOIN Users ON Particuliers.id_user = Users.id WHERE Users.email = 'john.doe@mail.com'),(SELECT id FROM Annonces WHERE titre = 'Manque de bois'), (SELECT NOW()), 0);

INSERT INTO Recherche(SELECT id FROM Annonces WHERE titre = 'Manque de bois');
INSERT INTO Dispos(id_annonce) VALUES(2);

INSERT INTO Annonces(titre, description, id_user, date, nb_likes) VALUES ('les travaux avancent', 'Nous avons fait bcp de choses',  (SELECT Modérateurs.id_user FROM Modérateurs JOIN Users ON Modérateurs.id_user = Users.id WHERE Users.email = 'clark.kent@mail.com'),(SELECT NOW()), 0);
INSERT INTO Avancées(id_annonce) VALUES((SELECT id FROM Annonces WHERE titre='les travaux avancent'));

SELECT * FROM Users;
SELECT * FROM Particuliers;
SELECT * FROM Modérateurs;
SELECT * FROM Admins;
SELECT * FROM Annonces;
SELECT * FROM Recherche;

UPDATE Users SET password = 'motDePasseModifié' WHERE email = 'jane.doe@mail.com';
UPDATE Annonces SET titre = 'Nous manquons de bois de chêne' WHERE id = 1;



INSERT INTO Users(username) VALUES('utilisateur introuvable');


UPDATE Particuliers set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
UPDATE Modérateurs set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
UPDATE Admins set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
UPDATE Annonces set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
DELETE FROM Users WHERE email = 'jane.doe@mail.com';

ALTER TABLE Annonces ADD pinned BOOL;

UPDATE Users SET activités = 'soudure;peinture' WHERE id = 7;
ALTER TABLE Users RENAME COLUMN activités TO activites;

UPDATE Users SET profile_picture = 'https://commons.wikimedia.org/wiki/File:Lion_d%27Afrique.jpg?uselang=fr' WHERE id = 7;
ALTER TABLE Annonces RENAME COLUMN id_annonce_mère TO id_annonce_mere;

ALTER TABLE Annonces ALTER COLUMN image TYPE VARCHAR(500);

INSERT INTO Annonces(titre, description, id_user, image, nb_likes, pinned) VALUES('Titre de ma super Annonce', 'description de ma super annonce blablabla lorem ipsum jsp', (SELECT id_user FROM Modérateurs WHERE id_user = 3), 'https://opac.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9811bb53-5392-47b7-a8b3-3d26d47e8c49%2Fd35c2720-4b39-4b38-afda-3cfe8025e2cb%2Ffour-solaire.JPG-1.webp?table=block&id=2d754ec7-2855-40b8-a3a6-e86ef539a7c6&spaceId=9811bb53-5392-47b7-a8b3-3d26d47e8c49&width=2000&userId=&cache=v2', 5, true);

INSERT INTO Annonces(description, id_user, id_annonce_mere, nb_likes) VALUES('wouaou mais quelle belle annonce!', (SELECT id_user FROM Particuliers WHERE id_user = 7), (SELECT id FROM Annonces WHERE id = (SELECT id FROM Annonces LIMIT 1)), 2);