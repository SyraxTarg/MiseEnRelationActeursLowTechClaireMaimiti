CREATE DATABASE lowTech;
\c lowtech;
CREATE TABLE Users(id SERIAL PRIMARY KEY, username VARCHAR(50), password VARCHAR(50), profile_picture VARCHAR(50), email VARCHAR(50));
CREATE TABLE Particuliers(id_user int, activités VARCHAR(50), FOREIGN KEY(id_user) REFERENCES Users(id));
CREATE TABLE Modérateurs(id_user int, activités VARCHAR(50), FOREIGN KEY(id_user) REFERENCES Users(id));
CREATE TABLE Admins(id_user int, FOREIGN KEY(id_user) REFERENCES Users(id));
CREATE TABLE Annonces(id SERIAL PRIMARY KEY, titre VARCHAR(50), description TEXT, id_user int, date date, id_annonce_mère int, image VARCHAR(255), nb_likes int, FOREIGN KEY(id_user) REFERENCES Users(id), FOREIGN KEY(id_annonce_mère) REFERENCES Annonces(id));
ALTER TABLE Users ALTER COLUMN profile_picture TYPE VARCHAR(255);
CREATE TABLE Recherche(id_annonce int, FOREIGN KEY(id_annonce) REFERENCES Annonces(id));
CREATE TABLE Avancées(id_annonce int, FOREIGN KEY(id_annonce) REFERENCES Annonces(id));
CREATE TABLE Dispos(id_annonce int, FOREIGN KEY(id_annonce) REFERENCES Annonces(id));

INSERT INTO Users(username, password, profile_picture, email) VALUES ('John Doe', 'motDePasse', 'https://www.google.com/url?sa=i&url=https%3A%2F%2Ffr.wikipedia.org%2Fwiki%2FLion&psig=AOvVaw3nNornN2MDSeaq5F62rsVH&ust=1703105590269000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCODoqvCwnIMDFQAAAAAdAAAAABAD', 'john.doe@mail.com');
INSERT INTO Particuliers( SELECT id FROM Users WHERE email = 'john.doe@mail.com');

INSERT INTO Users(username, password, email) VALUES ('Jane Doe', 'motDePasseDeJane', 'jane.doe@mail.com');
INSERT INTO Particuliers( SELECT id FROM Users WHERE email = 'jane.doe@mail.com');

ALTER TABLE Users ALTER COLUMN profile_picture TYPE VARCHAR(500);

INSERT INTO Users(username, password, email) VALUES ('Clark Kent', 'jeSuisSuperman', 'clark.kent@mail.com');
INSERT INTO Modérateurs( SELECT id FROM Users WHERE email = 'clark.kent@mail.com');
INSERT INTO Users(username, password, profile_picture, email) VALUES ('Bruce Wayne', 'jeSuisBatman', 'https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.comicsuniverse.it%2Fil-futuro-di-michael-keaton-come-batman-dopo-the-flash-e-incerto-rimarra-canonico-o-no%2F&psig=AOvVaw0faW7TlQ6P4MArTxTvcJl4&ust=1703105999643000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCOCbubaynIMDFQAAAAAdAAAAABAI', 'bruce.wayne@mail.com');
INSERT INTO Modérateurs( SELECT id FROM Users WHERE email = 'bruce.wayne@mail.com');

ALTER TABLE Users ADD Activités TEXT;


INSERT INTO Annonces(titre, description, id_user, nb_likes) VALUES ('Manque de bois', 'Nous manquons de bois.',  (SELECT Modérateurs.id_user FROM Modérateurs JOIN Users ON Modérateurs.id_user = Users.id WHERE Users.email = 'bruce.wayne@mail.com'), 0);

INSERT INTO Annonces(description, id_user, id_annonce_mère, date, nb_likes) VALUES ('Pas de souci je peux en ramener',  (SELECT Particuliers.id_user FROM Particuliers JOIN Users ON Particuliers.id_user = Users.id WHERE Users.email = 'john.doe@mail.com'),(SELECT id FROM Annonces WHERE titre = 'Manque de bois'), (SELECT NOW()), 0);

INSERT INTO Recherche(SELECT id FROM Annonces WHERE titre = 'Manque de bois');
INSERT INTO Dispos(id_annonce) VALUES(2);

INSERT INTO Annonces(titre, description, id_user, date, nb_likes) VALUES ('les travaux avancent', 'Nous avons fait bcp de choses',  (SELECT Modérateurs.id_user FROM Modérateurs JOIN Users ON Modérateurs.id_user = Users.id WHERE Users.email = 'clark.kent@mail.com'),(SELECT NOW()), 0);
INSERT INTO Avancées(id_annonce) VALUES((SELECT id FROM Annonces WHERE titre='les travaux avancent'));

SELECT * FROM Users;
SELECT * FROM Particuliers;
SELECT * FROM Modérateurs;
SELECT * FROM Admins;
SELECT * FROM Annonces;
SELECT * FROM Recherche;

UPDATE Users SET password = 'motDePasseModifié' WHERE email = 'jane.doe@mail.com';
UPDATE Annonces SET titre = 'Nous manquons de bois de chêne' WHERE id = 1;



INSERT INTO Users(username) VALUES('utilisateur introuvable');


UPDATE Particuliers set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
UPDATE Modérateurs set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
UPDATE Admins set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
UPDATE Annonces set id_user = (SELECT id FROM Users WHERE username = 'utilisateur introuvable') WHERE id_user = (SELECT id FROM Users WHERE email = 'jane.doe@mail.com');
DELETE FROM Users WHERE email = 'jane.doe@mail.com';

ALTER TABLE Annonces ADD pinned BOOL;

UPDATE Users SET activités = 'soudure;peinture' WHERE id = 7;
ALTER TABLE Users RENAME COLUMN activités TO activites;

UPDATE Users SET profile_picture = 'https://commons.wikimedia.org/wiki/File:Lion_d%27Afrique.jpg?uselang=fr' WHERE id = 7;
ALTER TABLE Annonces RENAME COLUMN id_annonce_mère TO id_annonce_mere;

ALTER TABLE Annonces ALTER COLUMN image TYPE VARCHAR(500);

INSERT INTO Annonces(titre, description, id_user, image, nb_likes, pinned) VALUES('Titre de ma super Annonce', 'description de ma super annonce blablabla lorem ipsum jsp', (SELECT id_user FROM Modérateurs WHERE id_user = 3), 'https://opac.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F9811bb53-5392-47b7-a8b3-3d26d47e8c49%2Fd35c2720-4b39-4b38-afda-3cfe8025e2cb%2Ffour-solaire.JPG-1.webp?table=block&id=2d754ec7-2855-40b8-a3a6-e86ef539a7c6&spaceId=9811bb53-5392-47b7-a8b3-3d26d47e8c49&width=2000&userId=&cache=v2', 5, true);

INSERT INTO Annonces(description, id_user, id_annonce_mere, nb_likes) VALUES('wouaou mais quelle belle annonce!', (SELECT id_user FROM Particuliers WHERE id_user = 7), (SELECT id FROM Annonces WHERE id = (SELECT id FROM Annonces LIMIT 1)), 2);

INSERT INTO Annonces (titre, description, id_user, nb_likes, pinned) VALUES('titre annonce pinned', 'ma description qui tue', 3, 2, true);
INSERT INTO Annonces(description, id_user, id_annonce_mere) VALUES('description commentaire 1', 5, (SELECT id FROM Annonces WHERE id = (SELECT id FROM Annonces LIMIT 1)));
INSERT INTO Annonces(description, id_user, id_annonce_mere) VALUES('description commentaire 1', 5, 7);
INSERT INTO Annonces(description, id_user, id_annonce_mere) VALUES('description commentaire 1', 5, 7);
INSERT INTO Annonces(description, id_user, id_annonce_mere) VALUES('description commentaire 1', 5, 7);

INSERT INTO Annonces (titre, description, id_user, nb_likes, pinned) VALUES('titre annonce pas pinned', 'ma description qui tue', 3, 2, false);
INSERT INTO Annonces (titre, description, id_user, nb_likes, pinned) VALUES('titre annonce pas pinned', 'ma description qui tue', 3, 2, false);
INSERT INTO Annonces (titre, description, id_user, nb_likes, pinned) VALUES('titre annonce pas pinned', 'ma description qui tue', 3, 2, false);
INSERT INTO Annonces (titre, description, id_user, nb_likes, pinned) VALUES('titre annonce pas pinned', 'ma description qui tue', 3, 2, false);

UPDATE Annonces SET date = (SELECT NOW()) WHERE date is null;

*****AJOUTS DU 27/12/2023*************


UPDATE Annonces SET date = (SELECT NOW()) where id = 1;
UPDATE Annonces SET date = (SELECT NOW()) where id = 2;
UPDATE Annonces SET date = (SELECT NOW()) where id = 3;
UPDATE Annonces SET date = (SELECT NOW()) where id = 4;
UPDATE Annonces SET date = (SELECT NOW()) where id = 5;
UPDATE Annonces SET date = (SELECT NOW()) where id = 6;
UPDATE Annonces SET date = (SELECT NOW()) where id = 7;
UPDATE Annonces SET date = (SELECT NOW()) where id = 8;
UPDATE Annonces SET date = (SELECT NOW()) where id = 9;
UPDATE Annonces SET date = (SELECT NOW()) where id = 10;
UPDATE Annonces SET date = (SELECT NOW()) where id = 11;
UPDATE Annonces SET date = (SELECT NOW()) where id = 12;
UPDATE Annonces SET date = (SELECT NOW()) where id = 13;
UPDATE Annonces SET date = (SELECT NOW()) where id = 14;
UPDATE Annonces SET date = (SELECT NOW()) where id = 15;
UPDATE Annonces SET date = (SELECT NOW()) where id = 16;
UPDATE Annonces SET date = (SELECT NOW()) where id = 17;
UPDATE Annonces SET date = (SELECT NOW()) where id = 18;
UPDATE Annonces SET date = (SELECT NOW()) where id = 19;
UPDATE Annonces SET date = (SELECT NOW()) where id = 20;
UPDATE Annonces SET date = (SELECT NOW()) where id = 21;
UPDATE Annonces SET date = (SELECT NOW()) where id = 22;
UPDATE Annonces SET date = (SELECT NOW()) where id = 23;
UPDATE Annonces SET date = (SELECT NOW()) where id = 24;
UPDATE Annonces SET date = (SELECT NOW()) where id = 25;
UPDATE Annonces SET date = (SELECT NOW()) where id = 26;
UPDATE Annonces SET date = (SELECT NOW()) where id = 27;

ALTER TABLE Avancées RENAME TO Avancees;

INSERT INTO Recherche(id_annonce) VALUES(7),(10),(13),(16),(19),(22),(25);
INSERT INTO Dispos(id_annonce) VALUES(5),(8),(11),(14),(17),(20),(23),(26);
INSERT INTO Avancees(id_annonce) VALUES(6),(9),(12),(15),(18),(21),(24),(27);



************************modif du 29/12/2023**********************
ALTER TABLE Annonces ALTER COLUMN date TYPE TIMESTAMP;